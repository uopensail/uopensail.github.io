# RecGo推荐系统架构简介

本系统采用模块化工业流水线设计，将推荐流程解耦为六大核心组件，形成完整的推荐生产链路：

**1. 物料池（Item Pool）**  
作为系统的"原料仓库"，负责商品存储、质量过滤。通过库存状态、时效性等业务规则筛选可推荐商品，构建高质量候选商品库。

**2. 流水线（Pipeline）**  
扮演"生产调度中心"角色，通过可编排的流程模板协调各组件工作。支持多策略AB实验，根据用户类型动态分配流量至不同策略组合（如保守推荐、新品探索、促销导购），实现策略的灵活部署与灰度发布。

**3. 频控系统（Frequency Control）**  
承担"用户体验守护者"职责，基于时间滑动窗口分析用户历史行为，对重复出现的商品/类目进行智能拦截。采用分级管控策略，对高价商品实施严格频控，对快消品适当放宽限制。

**4. 召回系统（Recall）**  
作为"候选集生产车间"，包含匹配召回与模型召回双引擎。匹配召回通过用户显性特征实现精准检索，模型召回利用嵌入向量捕捉深层兴趣，两者协同保障召回结果的覆盖率与相关性。

**5. 排序系统（Rank）**  
担任"商品质量检测官"，采用规则+模型双阶段排序。规则层快速执行运营策略（如促销加权），模型层通过CTR预估进行精细化打分，兼顾业务目标与用户体验的平衡。

**6. 重排系统（Rerank）**  
作为"最终装配线"，通过多样性约束、疲劳度衰减等策略优化列表展示效果。保障推荐结果在品牌、价格带、类目等维度的合理分布，避免同质化推荐带来的用户体验下降。

整个系统通过API网关对外提供服务，接收用户特征与上下文参数后，依次执行频控过滤→多路召回→混合排序→多样性调整的标准化生产流程，最终输出30-50个有序商品ID列表，响应延迟控制在200ms以内。

```mermaid

graph TD
    A[用户请求] --> B{流量分配}
    B -->|Pipeline 1| C1[Pipeline 1]
    B -->|Pipeline 2| D1[Pipeline 2]
    B -->|Pipeline 3| E1[Pipeline 3]

    subgraph Pipeline 1
        C1 --> C2{并行频控}
        C2 --> C21[频控1]
        C2 --> C22[频控2]
        C2 --> C23[频控3]
        C21 --> C3{并行召回}
        C22 --> C3
        C23 --> C3
        C3 --> C31[匹配召回]
        C3 --> C32[模型召回]
        C31 --> C4[模型排序]
        C32 --> C4
        C4 --> C5{并行重排}
        C5 --> C51[打散]
        C5 --> C52[调权]
        C5 --> C53[强插]
        C51 --> C6[推荐结果]
        C52 --> C6
        C53 --> C6
    end

    subgraph Pipeline 2
        D1 --> D2{并行频控}
        D2 --> D21[频控4]
        D2 --> D22[频控5]
        D21 --> D3{并行召回}
        D22 --> D3
        D3 --> D31[匹配召回]
        D3 --> D32[模型召回]
        D31 --> D4[模型排序]
        D32 --> D4
        D4 --> D5{并行重排}
        D5 --> D51[打散]
        D5 --> D52[调权]
        D51 --> D6[推荐结果]
        D52 --> D6
    end

    subgraph Pipeline 3
        E1 --> E2{并行频控}
        E2 --> E21[频控5]
        E2 --> E22[频控6]
        E21 --> E3{并行召回}
        E22 --> E3
        E3 --> E31[匹配召回]
        E3 --> E32[模型召回]
        E31 --> E4[规则排序]
        E32 --> E4
        E4 --> E5{并行重排}
        E5 --> E51[打散]
        E5 --> E52[调权]
        E51 --> E6[推荐结果]
        E52 --> E6
    end

    classDef pipeline1 fill:#e6f3ff,stroke:#4d90fe
    classDef pipeline2 fill:#e6ffe6,stroke:#34a853
    classDef pipeline3 fill:#fff3e6,stroke:#f9ab00
    classDef freqCtrl fill:#ffe6e6,stroke:#dc3545
    classDef rerank fill:#e6ffe6,stroke:#28a745

    class C2,D2,E2 freqCtrl
    class C5,D5,E5 rerank
    class C1,C3,C4,C6 pipeline1
    class D1,D3,D4,D6 pipeline2
    class E1,E3,E4,E6 pipeline3
```
