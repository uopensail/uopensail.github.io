# 总览
## 一、RecGo推荐系统总览

场景：工厂生产标准化推荐商品
生产资料：商品池（所有可推荐商品）
产品：排序后的商品ID列表
交付方式：通过HTTP-API对外提供服务

## 二、核心组件说明

### 1. 物料池（Item Pool）

作用：存放所有待推荐商品
配置参数：

物料池名称（例：双11主会场商品池）
布尔过滤条件（例：库存>100的商品）
加速包配置（例：7天内上架的商品）
示例：
某电商的双11物料池包含10万商品，通过"库存>100"过滤后剩6万商品，给"7天内上架"的商品添加加速包使其加速推荐。



配置参数的模板

```toml
[ItemPool]
name = "双11主会场商品池" # 物料池名称
filter = "stock > 100" # 过滤条件, 库存>100的商品
boost = "publishTime + 86400*7 >= currentTime()" # 加速包, 7天内上架的商品
```



### 2. 流水线（Pipeline）

作用：定义完整的推荐流程
配置参数：

参数名称    示例值    说明
流水线ID    P001    唯一标识符
流量占比    30%    分配30%用户流量
频控配置    见频控章节    过滤重复推荐
召回配置    见召回章节    初筛候选商品
排序配置    见排序章节    精细排序
重排配置    见重排章节    最终调整
示例：
平台同时运行三条流水线：

P001（50%流量）：保守型策略，优先推荐复购商品
P002（30%流量）：探索型策略，推荐新品
P003（20%流量）：促销策略，主推高折扣商品

### 3. 频控（Frequency Control）

作用：避免过度打扰用户
配置参数：
```json
{
  "timespan": "7天",   # 时间窗口
  "action": "点击",     # 用户行为类型
  "frequency": 3       # 最大允许次数
}
```
示例：
当用户在7天内已点击过3次「扫地机器人」类商品，后续推荐将自动过滤该类商品。

4. 召回系统（Candidate Generation）
   4.1 匹配召回
   工作原理：用户特征→生成查询键→倒排索引查找
   配置参数：
```json
{
  "召回量": 500,
  "键最大长度": 20,
  "特征列表": "年龄,性别,最近浏览",
  "索引存储": "redis://prod-index-01",
  "键格式": "usr_%d_%s" # 示例：usr_25_male
}
```
示例：
根据25岁男性用户生成键usr_25_male，从倒排索引中召回男装、游戏设备等商品。

4.2 模型召回
工作原理：双塔模型计算用户-商品相似度
配置参数：

```json
{
  "服务地址": "http://rec-model:8080",
  "召回量": 300,
  "超时时间": 200ms
}
```
示例：
用户浏览3款咖啡机后，模型召回咖啡胶囊、磨豆器等关联商品。

5. 排序系统（Ranking）
   5.1 规则排序
   策略类型：

公式排序：得分 = 销量*0.6 + 收藏量*0.4
召回优先级：["历史购买", "协同过滤", "新品推荐"]
示例：
某商品销量5000次、收藏量2000次，则得分=50000.6 + 20000.4 = 3800分

5.2 模型排序
配置参数：
```json
{
  "服务地址": "http://rank-model:8080",
  "输入特征": ["用户画像", "商品标签", "上下文特征"]
}
```
示例：
CTR预测模型将用户可能点击的商品排在前面。

6. 重排系统（Rerank）
   作用：保证推荐结果多样性
   配置参数：
```json
[
  {"特征": "商家", "最大次数": 2}, 
  {"特征": "商品类目", "最大次数": 3}
]
```
示例：
最终结果中确保：

同一商家商品不超过2个
同一类目商品不超过3个
三、完整工作流程示例
用户场景：28岁女性打开电商APP首页

频控过滤：排除上周已购买商品
多路召回：
匹配召回：女装/美妆类600件
模型召回：根据浏览记录召回300件
排序阶段：
规则排序：促销商品加权
模型排序：预测点击率排序
重排调整：确保展示5个不同品牌
最终结果：展示30个商品，包含连衣裙、化妆品、健身器材等多样化推荐
