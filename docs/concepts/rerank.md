# 重排

在推荐系统完成初始排序后，需通过重排阶段进行业务策略干预。该阶段主要实现三大核心功能：

## 一、多样性保障策略（打散机制）

**功能目标**  
确保相邻推荐结果中特定属性内容的合理分布，避免同类内容过度集中

**实现逻辑**

- 定义字段属性约束，例如同标签内容连续出现不超过3次
- 当规则叠加导致候选池不足时，采用后进先出原则逐级解除约束

```toml
[[Pipeline.Rerank]]
name = "标签多样性控制"
rerank_type = 0  # 打散类型标识
field = "tag"    # 目标约束字段
count = 3        # 最大连续出现次数
```

## 二、动态权重调整策略（调权机制）

**业务场景**  
针对时效性内容或需加速曝光的物料进行动态提权

**实现特性**

- 支持多维度权重调整，策略间无冲突叠加
- 采用条件表达式进行精准受众筛选

```toml
[[Pipeline.Rerank]]
name = "时效性内容提权"
rerank_type = 1
weight = 1.5  # 权重增强系数（新权重=原始分*1.5）
condition = "publishTime + 604800 > currentTime()"  # 发布70天内内容
```

## 三、强运营位策略（固定插入）

**业务需求**  
满足特定运营需求，在指定位置插入目标物料

**实现原则**

- 插入内容豁免其他重排规则
- 多策略冲突时按配置顺序优先执行

```toml
[[Pipeline.Rerank]]
name = "新品推荐位"
rerank_type = 2
position = 3  # 插入第三推荐位
condition = "publishTime + 604800 >= currentTime()"  # 近7天发布商品
```

**策略优先级说明**  
系统按配置文件中的声明顺序执行策略，建议按"固定插入→调权→打散"顺序配置以符合业务优先级。
